!function(){function t(t){this.battle=new e.Battle(t),this.canvas=this.battle.canvas,this.canvasRect=this.canvas.getBoundingClientRect(),this.bindMethods(),this.newGame()}var e={Game:t};window.Shooter=e,t.prototype.bindMethods=function(){this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onFrameUpdate=this.onFrameUpdate.bind(this),this.onNewEnemies=this.onNewEnemies.bind(this),this.onBulletsQueue=this.onBulletsQueue.bind(this)},t.prototype.newGame=function(){this.battle.newBattle(),this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("mousedown",this.onMouseDown),this.canvas.addEventListener("mouseup",this.onMouseUp),this.framePerSecond=50,this.frameId=setInterval(this.onFrameUpdate,1e3/this.framePerSecond),this.newEnemiesMs=2e3,this.newEnemiesId=setInterval(this.onNewEnemies,this.newEnemiesMs),this.bulletsQueueMs=150},t.prototype.stopGame=function(){this.canvas.removeEventListener("mousemove",this.onMouseMove),this.canvas.removeEventListener("mousedown",this.onMouseDown),this.canvas.removeEventListener("mouseup",this.onMouseUp),clearInterval(this.frameId),clearInterval(this.newEnemiesId),clearInterval(this.bulletsQueueId)},t.prototype.onFrameUpdate=function(){this.battle.draw(),this.battle.gameOver&&this.stopGame()},t.prototype.onNewEnemies=function(){this.battle.createEnemies()},t.prototype.onBulletsQueue=function(){this.battle.createBullet()},t.prototype.onMouseMove=function(t){var e=this.battle.gun,i=t.clientX-this.canvasRect.left-e.width/2;e.moveWithinX(i),e.draw()},t.prototype.onMouseDown=function(t){this.battle.createBullet(),clearInterval(this.bulletsQueueId),this.bulletsQueueId=setInterval(this.onBulletsQueue,this.bulletsQueueMs)},t.prototype.onMouseUp=function(t){clearInterval(this.bulletsQueueId)},t.prototype.destroy=function(){this.stopGame(),this.battle.destroy()}}(),function(t){function e(t,e,i,s,h,o){this.ctx=t,this.width=s,this.height=h,this.fill=o,this.moveX(e),this.moveY(i)}t.Gun=e,e.prototype.moveX=function(t){this.x=t,this.left=t,this.right=t+this.width},e.prototype.moveWithinX=function(t){this.moveX(t),this.left<0?this.moveX(0):this.right>this.ctx.canvas.width&&this.moveX(this.ctx.canvas.width-this.width)},e.prototype.moveY=function(t){this.y=t,this.top=t,this.bottom=t+this.height},e.prototype.draw=function(){this.ctx.fillStyle=this.fill,this.ctx.fillRect(this.x,this.y,this.width,this.height)}}(window.Shooter),function(t){function e(t,e,s,h,o){this.ctx=t,this.radius=h,this.fill=o,this.result=i.None,this.moveX(e),this.moveY(s)}var i={None:0,Miss:1,Hit:2};t.Bullet=e,t.BulletResult=i,e.prototype.moveX=function(t){this.x=t,this.left=t-this.radius,this.right=t+this.radius},e.prototype.moveY=function(t){this.y=t,this.top=t-this.radius,this.bottom=t+this.radius},e.prototype.draw=function(){var t=this.ctx;t.fillStyle=this.fill,t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.fill()}}(window.Shooter),function(t){function e(t,e,i,s,h,o){this.ctx=t,this.width=s,this.height=h,this.fill=o,this.dead=!1,this.moveX(e),this.moveY(i)}t.Enemy=e;var i=t.BulletResult;e.prototype.moveX=function(t){this.x=t,this.left=t,this.right=t+this.width},e.prototype.moveY=function(t){this.y=t,this.top=t,this.bottom=t+this.height},e.prototype.draw=function(){this.ctx.fillStyle=this.fill,this.ctx.fillRect(this.x,this.y,this.width,this.height)},e.prototype.hitByBullet=function(t){return t.result===i.None&&t.top<=this.bottom&&(t.left>=this.left&&t.left<=this.right||t.right>=this.left&&t.right<=this.right)}}(window.Shooter),function(t){function e(t,e,i,s,h){this.ctx=t,this.x=e,this.y=i,this.fontSize=s,this.fill=h,this.text="",this.clear()}t.Stats=e,e.prototype.prepareText=function(){this.text="Shoots: "+this.shoots+" / Hits: "+this.hit+" / Miss: "+this.miss},e.prototype.clear=function(){this.shoots=0,this.hit=0,this.miss=0,this.prepareText()},e.prototype.draw=function(){this.prepareText();var t=this.ctx;t.font=this.fontSize+"px sans-serif",t.fillStyle=this.fill,t.textBaseline="top",t.fillText(this.text,this.x,this.y)}}(window.Shooter),function(t){function e(t){this.options=t,this.width=t.width,this.height=t.height,this.bulletStep=.01*this.width,this.createCanvas(),this.createStats(),this.createGun()}t.Battle=e;var i=t.BulletResult;e.prototype.newBattle=function(){this.gameOver=!1,this.bullets=[],this.bulletsLen=0,this.enemies=[],this.enemiesLen=0,this.nearestEnemy=null,this.stats.clear(),this.createEnemies(),this.draw()},e.prototype.createCanvas=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height,this.canvas=t,this.ctx=t.getContext("2d"),this.options.parent.appendChild(t)},e.prototype.createStats=function(){var e=this.perOfNum(2,this.width),i=this.perOfNum(95,this.height),s=this.perOfNum(2.5,this.height);this.stats=new t.Stats(this.ctx,e,i,s,this.options.statsFill)},e.prototype.createGun=function(){var e=this.stats,i=this.perOfNum(6,this.width),s=this.perOfNum(6,this.width),h=Math.round(this.width/2-i/2),o=Math.round(e.y-e.fontSize-s);this.gun=new t.Gun(this.ctx,h,o,i,s,this.options.gunFill)},e.prototype.createBullet=function(){var e=this.gun,i=this.bullets,s=e.x+e.width/2,h=e.y,o=this.perOfNum(1,this.width);i.push(new t.Bullet(this.ctx,s,h,o,this.options.bulletFill)),this.bulletsLen=i.length},e.prototype.createEnemies=function(){var e=this.enemies,i=this.enemiesLen,s=this.options.enemyFill,h=this.perOfNum(1.8,this.width),o=Math.round((this.width-h)/12);x=h,y=h,width=o-h,height=o-h;for(var n,r=0;r<i;++r)n=e[r],n.dead||(n.moveY(n.bottom+h),n.draw());for(var r=0;r<12;++r)e.push(new t.Enemy(this.ctx,x,y,width,height,s)),x+=width+h;this.enemiesLen=e.length},e.prototype.clear=function(){this.ctx.fillStyle=this.options.bgFill,this.ctx.fillRect(0,0,this.width,this.height)},e.prototype.draw=function(){this.clear(),this.drawGun(),this.drawBullets(),this.drawEnemies(),this.drawStats(),this.checkGameOver(),this.gameOver&&this.drawGameOver()},e.prototype.drawGun=function(){this.gun.draw()},e.prototype.drawBullets=function(){for(var t,e=this.bullets,s=this.bulletsLen,h=this.bulletStep,o=0;o<s;++o)t=e[o],t.result!==i.Hit&&t.result!==i.Miss&&(t.bottom<=0?t.result=i.Miss:(t.moveY(t.y-h),t.draw()))},e.prototype.drawEnemies=function(){for(var e,i,s,h=this.enemies,o=this.enemiesLen,n=this.bullets,r=this.bulletsLen,l=h[0],a=0;a<o;++a)if(e=h[a],!e.dead){s=null;for(var u=0;u<r;++u)if(i=n[u],e.hitByBullet(i)){s=i;break}s?(e.dead=!0,s.result=t.BulletResult.Hit):(e.draw(),e.bottom>l.bottom&&(l=e))}this.nearestEnemy=l},e.prototype.drawStats=function(){var t,e=this.stats,s=this.bullets,h=this.bulletsLen;e.clear();for(var o=0;o<h;++o)t=s[o].result,t===i.Hit?++e.hit:t===i.Miss&&++e.miss,e.shoots+=1;e.draw()},e.prototype.drawGameOver=function(){var t=this.ctx;t.save(),t.globalAlpha=.8,t.fillStyle="white",t.fillRect(0,0,this.width,this.height);var e=.1*this.width;t.globalAlpha=1,t.fillStyle="black",t.textAlign="center",t.textBaseline="bottom",t.font=e+"px sans-serif",t.fillText("Game Over",this.width/2,this.height/2),e/=3,t.textBaseline="top",t.font=e+"px sans-serif",t.fillText(this.stats.text,this.width/2,this.height/2),t.restore()},e.prototype.checkGameOver=function(){this.gameOver=this.nearestEnemy&&this.nearestEnemy.bottom>=this.gun.top},e.prototype.destroy=function(){this.options.parent.removeChild(this.canvas)},e.prototype.perOfNum=function(t,e){return Math.floor(t*e/100)}}(window.Shooter);
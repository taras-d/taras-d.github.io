!function(){function t(t){this.battle=new Shooter.Battle(t),this.canvas=this.battle.canvas,this.canvasRect=this.canvas.getBoundingClientRect(),this.bindMethods(),this.newGame()}Shooter={},Shooter.Game=t,t.prototype.bindMethods=function(){this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onFrameUpdate=this.onFrameUpdate.bind(this),this.onNewEnemies=this.onNewEnemies.bind(this),this.onBulletsQueue=this.onBulletsQueue.bind(this)},t.prototype.newGame=function(){this.battle.newBattle(),this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("mousedown",this.onMouseDown),this.canvas.addEventListener("mouseup",this.onMouseUp),this.framePerSecond=50,this.frameId=setInterval(this.onFrameUpdate,1e3/this.framePerSecond),this.newEnemiesMs=2e3,this.newEnemiesId=setInterval(this.onNewEnemies,this.newEnemiesMs),this.bulletsQueueMs=150},t.prototype.stopGame=function(){this.canvas.removeEventListener("mousemove",this.onMouseMove),this.canvas.removeEventListener("mousedown",this.onMouseDown),this.canvas.removeEventListener("mouseup",this.onMouseUp),clearInterval(this.frameId),clearInterval(this.newEnemiesId),clearInterval(this.bulletsQueueId)},t.prototype.onFrameUpdate=function(){this.battle.draw(),this.battle.gameOver&&this.stopGame()},t.prototype.onNewEnemies=function(){this.battle.createEnemies()},t.prototype.onBulletsQueue=function(){this.battle.createBullet()},t.prototype.onMouseMove=function(t){var e=this.battle.gun,i=t.clientX-this.canvasRect.left-e.width/2;e.moveWithinX(i),e.draw()},t.prototype.onMouseDown=function(t){this.battle.createBullet(),clearInterval(this.bulletsQueueId),this.bulletsQueueId=setInterval(this.onBulletsQueue,this.bulletsQueueMs)},t.prototype.onMouseUp=function(t){clearInterval(this.bulletsQueueId)},t.prototype.destroy=function(){this.stopGame(),this.battle.destroy()}}(),function(){function t(t){this.options=t,this.width=t.width,this.height=t.height,this.bulletStep=.01*this.width,this.createCanvas(),this.createStats(),this.createGun()}Shooter.Battle=t,t.prototype.newBattle=function(){this.gameOver=!1,this.bullets=[],this.bulletsLen=0,this.enemies=[],this.enemiesLen=0,this.nearestEnemy=null,this.stats.clear(),this.createEnemies(),this.draw()},t.prototype.createCanvas=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height,this.canvas=t,this.ctx=t.getContext("2d"),this.options.parent.appendChild(t)},t.prototype.createStats=function(){var t=this.perOfNum(2,this.width),e=this.perOfNum(95,this.height),i=this.perOfNum(2.5,this.height);this.stats=new Shooter.Stats(this.ctx,t,e,i,this.options.statsFill)},t.prototype.createGun=function(){var t=this.stats,e=this.perOfNum(6,this.width),i=this.perOfNum(6,this.width),s=this.perOfNum(2,this.width),h=t.y-t.fontSize-i;this.gun=new Shooter.Gun(this.ctx,s,h,e,i,this.options.gunFill)},t.prototype.createBullet=function(){var t=this.gun,e=this.bullets,i=t.x+t.width/2,s=t.y,h=this.perOfNum(1,this.width);e.push(new Shooter.Bullet(this.ctx,i,s,h,this.options.bulletFill)),this.bulletsLen=e.length},t.prototype.createEnemies=function(){var t=this.enemies,e=this.enemiesLen,i=this.options.enemyFill,s=this.perOfNum(1.8,this.width),h=Math.round((this.width-s)/12);x=s,y=s,width=h-s,height=h-s;for(var o,n=0;n<e;++n)o=t[n],o.dead||(o.moveY(o.bottom+s),o.draw());for(var n=0;n<12;++n)t.push(new Shooter.Enemy(this.ctx,x,y,width,height,i)),x+=width+s;this.enemiesLen=t.length},t.prototype.clear=function(){this.ctx.fillStyle=this.options.bgFill,this.ctx.fillRect(0,0,this.width,this.height)},t.prototype.draw=function(){this.clear(),this.drawGun(),this.drawBullets(),this.drawEnemies(),this.drawStats(),this.checkGameOver(),this.gameOver&&this.drawGameOver()},t.prototype.drawGun=function(){this.gun.draw()},t.prototype.drawBullets=function(){for(var t,e=this.bullets,i=this.bulletsLen,s=this.bulletStep,h=0;h<i;++h)t=e[h],t.result!==Shooter.BulletResult.Hit&&t.result!==Shooter.BulletResult.Miss&&(t.bottom<=0?t.result=Shooter.BulletResult.Miss:(t.moveY(t.y-s),t.draw()))},t.prototype.drawEnemies=function(){for(var t,e,i,s=this.enemies,h=this.enemiesLen,o=this.bullets,n=this.bulletsLen,r=s[0],l=0;l<h;++l)if(t=s[l],!t.dead){i=null;for(var a=0;a<n;++a)if(e=o[a],t.hitByBullet(e)){i=e;break}i?(t.dead=!0,i.result=Shooter.BulletResult.Hit):(t.draw(),t.bottom>r.bottom&&(r=t))}this.nearestEnemy=r},t.prototype.drawStats=function(){var t,e=this.stats,i=this.bullets,s=this.bulletsLen;e.clear();for(var h=0;h<s;++h)t=i[h].result,t===Shooter.BulletResult.Hit?++e.hit:t===Shooter.BulletResult.Miss&&++e.miss,e.shoots+=1;e.draw()},t.prototype.drawGameOver=function(){var t=this.ctx;t.save(),t.globalAlpha=.8,t.fillStyle="white",t.fillRect(0,0,this.width,this.height);var e=.1*this.width;t.globalAlpha=1,t.fillStyle="black",t.textAlign="center",t.textBaseline="bottom",t.font=e+"px sans-serif",t.fillText("Game Over",this.width/2,this.height/2),e/=3,t.textBaseline="top",t.font=e+"px sans-serif",t.fillText(this.stats.text,this.width/2,this.height/2),t.restore()},t.prototype.checkGameOver=function(){this.gameOver=this.nearestEnemy&&this.nearestEnemy.bottom>=this.gun.top},t.prototype.destroy=function(){this.parent.removeChild(this.canvas)},t.prototype.perOfNum=function(t,e){return Math.floor(t*e/100)}}(),function(){function t(t,e,i,s,h,o){this.ctx=t,this.width=s,this.height=h,this.fill=o,this.moveX(e),this.moveY(i)}Shooter.Gun=t,t.prototype.moveX=function(t){this.x=t,this.left=t,this.right=t+this.width},t.prototype.moveWithinX=function(t){this.moveX(t),this.left<0?this.moveX(0):this.right>this.ctx.canvas.width&&this.moveX(this.ctx.canvas.width-this.width)},t.prototype.moveY=function(t){this.y=t,this.top=t,this.bottom=t+this.height},t.prototype.draw=function(){this.ctx.fillStyle=this.fill,this.ctx.fillRect(this.x,this.y,this.width,this.height)}}(),function(){function t(t,i,s,h,o){this.ctx=t,this.radius=h,this.fill=o,this.result=e.None,this.moveX(i),this.moveY(s)}var e={None:0,Miss:1,Hit:2};Shooter.Bullet=t,Shooter.BulletResult=e,t.prototype.moveX=function(t){this.x=t,this.left=t-this.radius,this.right=t+this.radius},t.prototype.moveY=function(t){this.y=t,this.top=t-this.radius,this.bottom=t+this.radius},t.prototype.draw=function(){var t=this.ctx;t.fillStyle=this.fill,t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.fill()}}(),function(){function t(t,e,i,s,h,o){this.ctx=t,this.width=s,this.height=h,this.fill=o,this.dead=!1,this.moveX(e),this.moveY(i)}Shooter.Enemy=t,t.prototype.moveX=function(t){this.x=t,this.left=t,this.right=t+this.width},t.prototype.moveY=function(t){this.y=t,this.top=t,this.bottom=t+this.height},t.prototype.draw=function(){this.ctx.fillStyle=this.fill,this.ctx.fillRect(this.x,this.y,this.width,this.height)},t.prototype.hitByBullet=function(t){return t.result===Shooter.BulletResult.None&&t.top<=this.bottom&&(t.left>=this.left&&t.left<=this.right||t.right>=this.left&&t.right<=this.right)}}(),function(){function t(t,e,i,s,h){this.ctx=t,this.x=e,this.y=i,this.fontSize=s,this.fill=h,this.text="",this.clear()}Shooter.Stats=t,t.prototype.prepareText=function(){this.text="Shoots: "+this.shoots+" / Hits: "+this.hit+" / Miss: "+this.miss},t.prototype.clear=function(){this.shoots=0,this.hit=0,this.miss=0,this.prepareText()},t.prototype.draw=function(){this.prepareText();var t=this.ctx;t.font=this.fontSize+"px sans-serif",t.fillStyle=this.fill,t.textBaseline="top",t.fillText(this.text,this.x,this.y)}}();